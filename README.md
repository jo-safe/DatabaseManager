# DatabaseManager

### Расширение проекта PostgreSQL-Operator

Данный проект представляет собой доработку и расширение исходного инструмента PostgreSQL-Operator, с акцентом на миграцию данных между PostgreSQL-базами, логирование и интеграцию с внешними GUI-приложениями.

Логика реализована на языке c++ с расчетом на использование в виде библиотеки для последующей интеграции в полноценное приложение. Пример приложения, использующего библиотеку, реализован на C# WPF.

## Структура проекта

### Компоненты C++ библиотеки

1. Logger - простейшая система логирования с поддержкой типов сообщений (DEBUG, INFO, WARN, ERROR) с возможностью передачи сообщений в хост-приложение (через callback-функцию) и сохранением в файл в json-формате.
2. DatabaseMigrator - утилита миграции PostgreSQL баз данных с возможностью настройки миграции (в конструктор передаются данные о json-конфиг-файле) и отслеживанием прогресса миграции (через callback-функцию). Поддерживает преобразование больших и некорректных значений.
3. DatabaseOperator - компонент, практически идентичный реализованному в PostgreSQL-Operator функционалу: поддерживает подключение к базе данных, выполнение простых запросов и SQL-скриптов. Новые функции - создание и восстановление резервных копий базы данных в бинарном виде.
4. Interface - точка входа (для компиляции в .dll) с реализованным API в C-style виде.

### Приложение WPF (C#)

Реализован базовый GUI, охватывающий весь функционал собранной .dll (запуск и контроль миграции, работа с подключенной БД с использованием DatabaseOperator), отслеживание логов. Вызов функций библиотек происходит в асинхронном виде.

## Особенности сборки

	- работа с данным API требует сохранения указателей на обьекты, конструктор которых вызывается в используемых методах (InitializeDatabaseMigrator, ConnectDatabase), а также их передачу в функции для последующей работы с обьектами
	- релиз подготовлен для x64-архитектуры
	
## Примечания

### Пример config-файла для запуска миграции:

```json
{
  "source_database": {
    "host": "localhost",
    "port": 5432,
    "dbname": "source_db",
    "user": "source_user",
    "password": "source_password"
  },
  "target_database": {
    "host": "localhost",
    "port": 5432,
    "dbname": "target_db",
    "user": "target_user",
    "password": "target_password"
  },
  "tables": [
    {
      "source": "users",
      "target": "archived_users",
      "exclude": false,
      "create_if_missing": true,
      "columns": {
        "id": {
          "name": "user_id",
          "type": "BIGINT"
        },
        "name": {
          "name": "full_name",
          "type": "VARCHAR(255)"
        },
        "email": {
          "name": "email",
          "type": "TEXT"
        },
        "created_at": {
          "name": "registration_date",
          "type": "TIMESTAMP"
        }
      }
    }
  ]
}
```

### Пример config-файла для созданий резервной копии или ее восстановления

Этот config содержит в себе только названия таблиц, которые должны быть выгружены/загружены:

```json
{
  "tables": [
    "users",
    "products",
    "orders",
    "logs"
  ]
}
```
